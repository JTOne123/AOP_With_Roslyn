version: 1.0.{build}
image: Visual Studio 2017
init:
  # Good practise, because Windows line endings are different from Unix/Linux ones
  - cmd: git config --global core.autocrlf true
 
before_build:
  - cmd: dotnet --version
  - cmd: dotnet restore ./AOPRoslyn/AOPRoslyn.sln --verbosity m
  - cmd: dotnet tool install -g dotnet-aop
  - cmd: dotnet tool install -g coverlet.console
  - cmd: dotnet tool install -g dotnet-reportgenerator-globaltool --version 4.0.0-alpha10
  - cmd: dotnet aop

build_script:
  - cmd: dotnet publish ./AOPRoslyn/AOPRoslyn.sln
  
test_script:
  # restore packages for our unit tests
  - cmd: dotnet restore ./AOPRoslyn/TestAOP/TestAOP.csproj --verbosity m
  # run the unit tests (requires changing into the test directory)
  - cmd: dotnet test AOPRoslyn\TestAOP\TestAOP.csproj /p:CollectCoverage=true /p:CoverletOutputFormat=opencover 
  - cmd: dir coverage*.* /S
  - cmd: reportgenerator "-reports:./AOPRoslyn/TestAOP/coverage.opencover.xml" "-targetdir:coveragereport" -reporttypes:HTMLInline;HTMLSummary;Badges
on_finish :
  # any cleanup in here
deploy: off
